<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>üåÖ –ø—Ä–µ–ª–æ–º–ª–µ–Ω–∏–µ ¬∑ –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
            user-select: none;
        }

        body {
            font-family: 'Georgia', serif;
            background: linear-gradient(145deg, #2b1b0e, #8b4f1c);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 10px;
            position: relative;
        }

        /* –ó–∞–∫–∞—Ç */
        body::after {
            content: '';
            position: fixed;
            top: 5%;
            right: 5%;
            width: 200px;
            height: 200px;
            background: radial-gradient(circle, #ffb347, #ff8c42, transparent);
            border-radius: 50%;
            filter: blur(40px);
            opacity: 0.5;
            animation: sunGlow 6s infinite alternate;
        }

        @keyframes sunGlow {
            from { transform: scale(1); opacity: 0.4; }
            to { transform: scale(1.3); opacity: 0.7; }
        }

        .phone-frame {
            width: 100%;
            max-width: 400px;
            background: rgba(40, 25, 10, 0.9);
            backdrop-filter: blur(15px);
            border-radius: 40px;
            padding: 16px;
            border: 1px solid rgba(255, 200, 120, 0.3);
            position: relative;
            z-index: 10;
        }

        /* –õ–û–ë–ë–ò */
        .lobby {
            text-align: center;
        }

        .sun-large {
            font-size: 70px;
            filter: drop-shadow(0 0 30px #ff9f4b);
            animation: float 4s infinite alternate;
        }

        @keyframes float {
            from { transform: translateY(0); }
            to { transform: translateY(-10px); }
        }

        .title {
            font-size: 2rem;
            color: #ffebc0;
            text-shadow: 0 4px 15px #b45f1b;
            margin: 5px 0;
        }

        .input-box {
            width: 100%;
            padding: 16px;
            background: rgba(20, 10, 5, 0.7);
            border: 2px solid #b45f1b;
            border-radius: 30px;
            color: white;
            font-size: 1.2rem;
            margin: 10px 0;
        }

        .join-btn {
            width: 100%;
            padding: 18px;
            background: linear-gradient(45deg, #b45f1b, #7b3f0e);
            border: none;
            border-radius: 30px;
            color: white;
            font-size: 1.3rem;
            font-weight: bold;
            cursor: pointer;
            margin: 10px 0;
        }

        /* –≠–ö–†–ê–ù –ó–ê–î–ê–ù–ò–ô */
        .tasks-grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 6px;
            margin: 15px 0;
        }

        .task-cell {
            aspect-ratio: 1;
            background: rgba(100, 60, 20, 0.6);
            border: 2px solid #b45f1b;
            border-radius: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            color: #ffd89c;
            cursor: pointer;
        }

        .task-cell.completed {
            background: rgba(50, 100, 30, 0.6);
            border-color: #7cb342;
        }

        /* –ò–ù–¢–ï–†–ê–ö–¢–ò–í–ù–´–ï –ó–ê–î–ê–ù–ò–Ø */
        .interactive-area {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 30px;
            padding: 20px;
            margin: 15px 0;
            min-height: 300px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        /* –°–õ–ê–ô–î–ï–† */
        .slider-container {
            width: 100%;
            padding: 20px 0;
        }

        .slider-value {
            font-size: 3rem;
            color: #ffd966;
            text-align: center;
        }

        input[type=range] {
            width: 100%;
            height: 15px;
            background: linear-gradient(90deg, #b45f1b, #ffb45b);
            border-radius: 15px;
            -webkit-appearance: none;
        }

        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 50px;
            height: 50px;
            background: #ffd966;
            border-radius: 50%;
            border: 4px solid #b45f1b;
            box-shadow: 0 0 20px #ff9f4b;
            cursor: pointer;
        }

        /* –ö–ê–†–¢–û–ß–ö–ò –î–õ–Ø –ü–ê–† */
        .cards-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            width: 100%;
        }

        .memory-card {
            aspect-ratio: 1;
            background: #b45f1b;
            border-radius: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            color: white;
            cursor: pointer;
            transition: all 0.3s;
            transform-style: preserve-3d;
        }

        .memory-card.flipped {
            background: #7b3f0e;
            transform: rotateY(180deg);
        }

        .memory-card.matched {
            background: #4caf50;
            opacity: 0.5;
            cursor: default;
        }

        /* –î–ò–°–ö */
        .dial {
            width: 200px;
            height: 200px;
            border-radius: 50%;
            background: conic-gradient(#b45f1b, #ffb45b, #b45f1b);
            position: relative;
            margin: 20px auto;
            cursor: grab;
        }

        .dial-handle {
            width: 40px;
            height: 40px;
            background: #ffd966;
            border-radius: 50%;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            box-shadow: 0 0 20px gold;
        }

        /* –ü–ï–†–ï–¢–ê–°–ö–ò–í–ê–ù–ò–ï */
        .drag-items {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            justify-content: center;
            margin: 20px 0;
        }

        .drag-item {
            padding: 15px 20px;
            background: #b45f1b;
            border-radius: 30px;
            color: white;
            font-size: 1.3rem;
            cursor: grab;
        }

        .drop-zone {
            min-height: 100px;
            background: rgba(255, 180, 80, 0.2);
            border: 3px dashed #ffb45b;
            border-radius: 30px;
            margin: 20px 0;
            padding: 15px;
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }

        /* –õ–ê–ó–ï–† */
        .laser-canvas {
            width: 100%;
            height: 250px;
            background: rgba(0, 0, 0, 0.5);
            border-radius: 30px;
            touch-action: none;
        }

        /* –ö–ù–û–ü–ö–ê –û–¢–í–ï–¢–ê */
        .action-btn {
            width: 100%;
            padding: 18px;
            background: #4caf50;
            border: none;
            border-radius: 30px;
            color: white;
            font-size: 1.2rem;
            font-weight: bold;
            cursor: pointer;
            margin-top: 15px;
        }

        .hidden {
            display: none;
        }
    </style>
</head>
<body>
    <div class="phone-frame">
        <!-- –õ–û–ë–ë–ò -->
        <div id="lobby" class="lobby">
            <div class="sun-large">üåÖ</div>
            <div class="title">–ø—Ä–µ–ª–æ–º–ª–µ–Ω–∏–µ</div>
            <div style="color: #ffd89c; margin-bottom: 30px;">20 –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã—Ö –∑–∞–¥–∞–Ω–∏–π</div>

            <input type="text" id="playerName" class="input-box" placeholder="—Ç–≤–æ—ë –∏–º—è">
            <input type="text" id="gameCode" class="input-box" placeholder="–∫–æ–¥ –∏–≥—Ä—ã" maxlength="6">

            <button class="join-btn" onclick="joinGame()">–≤–æ–π—Ç–∏ –≤ –∏–≥—Ä—É</button>
        </div>

        <!-- –û–ñ–ò–î–ê–ù–ò–ï -->
        <div id="waiting" class="hidden">
            <div style="text-align: center; padding: 30px;">
                <div class="sun-large">‚è≥</div>
                <div style="font-size: 2rem; color: #ffd966;" id="displayCode">000000</div>
                <div style="color: #ffd89c; margin: 20px;">–∂–¥—ë–º —Å—Ç–∞—Ä—Ç–∞...</div>
                <div id="playersList"></div>
            </div>
        </div>

        <!-- –ò–ù–¢–ï–†–ê–ö–¢–ò–í -->
        <div id="game" class="hidden">
            <div style="display: flex; justify-content: space-between; margin-bottom: 15px;">
                <span id="taskCounter">1/20</span>
                <span id="timer" style="font-family: monospace; font-size: 1.5rem;">20:00</span>
            </div>

            <!-- –°–µ—Ç–∫–∞ –∑–∞–¥–∞–Ω–∏–π -->
            <div id="tasksGrid" class="tasks-grid"></div>

            <!-- –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–∞—è –æ–±–ª–∞—Å—Ç—å -->
            <div id="interactiveArea" class="interactive-area">
                <!-- –°—é–¥–∞ –≥—Ä—É–∑—è—Ç—Å—è –∑–∞–¥–∞–Ω–∏—è -->
            </div>
        </div>

        <!-- –†–ï–ó–£–õ–¨–¢–ê–¢–´ -->
        <div id="result" class="hidden">
            <div style="text-align: center;">
                <div class="sun-large">‚ú®</div>
                <div style="font-size: 3rem; color: gold;" id="finalScore">0</div>
                <div id="leaderboard"></div>
                <button class="join-btn" onclick="exitGame()" style="margin-top: 20px;">–≤—ã–π—Ç–∏</button>
            </div>
        </div>
    </div>

    <script src="firebase-config.js"></script>
    <script>
        // ============================================
        // –ò–ù–¢–ï–†–ê–ö–¢–ò–í–ù–´–ï –ó–ê–î–ê–ù–ò–Ø
        // ============================================

        const TASKS = [
            {   // 1. –°–õ–ê–ô–î–ï–† - –¥–≤–∏–≥–∞–µ—à—å –ø–æ–ª–∑—É–Ω–æ–∫
                id: 1,
                type: "slider",
                title: "üåÖ –ø–æ–π–º–∞–π –∑–∞–∫–∞—Ç",
                desc: "–ø–µ—Ä–µ–¥–≤–∏–Ω—å –ø–æ–ª–∑—É–Ω–æ–∫ –Ω–∞ 45¬∞",
                target: 45,
                render: function(container, onComplete) {
                    let value = 0;
                    container.innerHTML = `
                        <div style="text-align: center;">
                            <div class="slider-value" id="sliderVal">0¬∞</div>
                            <input type="range" id="slider" min="0" max="90" value="0">
                            <button class="action-btn" id="checkSlider">–≥–æ—Ç–æ–≤–æ</button>
                        </div>
                    `;
                    
                    document.getElementById('slider').addEventListener('input', (e) => {
                        value = e.target.value;
                        document.getElementById('sliderVal').textContent = value + '¬∞';
                    });
                    
                    document.getElementById('checkSlider').addEventListener('click', () => {
                        if (Math.abs(value - this.target) < 2) {
                            onComplete(true);
                        } else {
                            alert(`–Ω—É–∂–Ω–æ ${this.target}¬∞, –∞ —É —Ç–µ–±—è ${value}¬∞`);
                        }
                    });
                }
            },
            
            {   // 2. –ü–ï–†–ï–¢–ê–°–ö–ò–í–ê–ù–ò–ï - —Å–æ–±–µ—Ä–∏ —Ñ–æ—Ä–º—É–ª—É
                id: 2,
                type: "dragdrop",
                title: "üß© —Å–æ–±–µ—Ä–∏ —Ñ–æ—Ä–º—É–ª—É",
                desc: "–ø–µ—Ä–µ—Ç–∞—â–∏ —ç–ª–µ–º–µ–Ω—Ç—ã –≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–º –ø–æ—Ä—è–¥–∫–µ",
                pieces: ["n‚ÇÅ", "¬∑", "sin", "Œ±", "=", "n‚ÇÇ", "¬∑", "sin", "Œ≤"],
                render: function(container, onComplete) {
                    let dropped = [];
                    
                    container.innerHTML = `
                        <div class="drag-items" id="dragItems">
                            ${this.pieces.map(p => `<div class="drag-item" draggable="true">${p}</div>`).join('')}
                        </div>
                        <div class="drop-zone" id="dropZone"></div>
                        <button class="action-btn" id="checkDrag">–ø—Ä–æ–≤–µ—Ä–∏—Ç—å</button>
                    `;
                    
                    const items = document.querySelectorAll('.drag-item');
                    const dropZone = document.getElementById('dropZone');
                    
                    items.forEach(item => {
                        item.addEventListener('dragstart', (e) => {
                            e.dataTransfer.setData('text', e.target.textContent);
                        });
                    });
                    
                    dropZone.addEventListener('dragover', (e) => e.preventDefault());
                    
                    dropZone.addEventListener('drop', (e) => {
                        e.preventDefault();
                        const data = e.dataTransfer.getData('text');
                        const div = document.createElement('div');
                        div.className = 'drag-item';
                        div.textContent = data;
                        dropZone.appendChild(div);
                        dropped.push(data);
                        e.target.style.background = 'rgba(255,180,80,0.3)';
                        setTimeout(() => e.target.style.background = '', 200);
                    });
                    
                    document.getElementById('checkDrag').addEventListener('click', () => {
                        const correct = ["n‚ÇÅ", "¬∑", "sin", "Œ±", "=", "n‚ÇÇ", "¬∑", "sin", "Œ≤"];
                        if (dropped.length === correct.length && 
                            dropped.every((val, i) => val === correct[i])) {
                            onComplete(true);
                        } else {
                            alert('–ø–æ—Ä—è–¥–æ–∫ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π!');
                        }
                    });
                }
            },
            
            {   // 3. –ü–ê–†–´ - –Ω–∞–π–¥–∏ –ø–∞—Ä—É (–º–µ–º–æ—Ä–∏)
                id: 3,
                type: "memory",
                title: "üÉè –Ω–∞–π–¥–∏ –ø–∞—Ä—É",
                desc: "–Ω–∞–π–¥–∏ –≤—Å–µ –ø–∞—Ä—ã –∫–∞—Ä—Ç–æ—á–µ–∫",
                cards: [
                    {text: "–ø—Ä–µ–ª–æ–º–ª–µ–Ω–∏–µ", pair: 0},
                    {text: "–∏–∑–º–µ–Ω–µ–Ω–∏–µ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è", pair: 0},
                    {text: "–ø–æ–∫–∞–∑–∞—Ç–µ–ª—å", pair: 1},
                    {text: "n = c/v", pair: 1},
                    {text: "–∑–∞–∫–æ–Ω –°–Ω–µ–ª–ª–∏—É—Å–∞", pair: 2},
                    {text: "n‚ÇÅsinŒ± = n‚ÇÇsinŒ≤", pair: 2}
                ],
                render: function(container, onComplete) {
                    let shuffled = [...this.cards].sort(() => Math.random() - 0.5);
                    let flipped = [];
                    let matched = 0;
                    
                    container.innerHTML = `
                        <div class="cards-grid" id="memoryGrid">
                            ${shuffled.map((card, i) => `
                                <div class="memory-card" data-index="${i}" data-pair="${card.pair}">
                                    ‚ùì
                                </div>
                            `).join('')}
                        </div>
                    `;
                    
                    const cards = document.querySelectorAll('.memory-card');
                    
                    cards.forEach(card => {
                        card.addEventListener('click', () => {
                            if (card.classList.contains('matched') || card.classList.contains('flipped')) return;
                            
                            card.classList.add('flipped');
                            card.textContent = shuffled[card.dataset.index].text;
                            flipped.push(card);
                            
                            if (flipped.length === 2) {
                                const [c1, c2] = flipped;
                                if (c1.dataset.pair === c2.dataset.pair) {
                                    setTimeout(() => {
                                        c1.classList.add('matched');
                                        c2.classList.add('matched');
                                        flipped = [];
                                        matched += 2;
                                        if (matched === cards.length) {
                                            onComplete(true);
                                        }
                                    }, 500);
                                } else {
                                    setTimeout(() => {
                                        c1.classList.remove('flipped');
                                        c2.classList.remove('flipped');
                                        c1.textContent = '‚ùì';
                                        c2.textContent = '‚ùì';
                                        flipped = [];
                                    }, 700);
                                }
                            }
                        });
                    });
                }
            },
            
            {   // 4. –î–ò–°–ö - –∫—Ä—É—Ç–∏–ª–∫–∞
                id: 4,
                type: "dial",
                title: "‚Üª –ø–æ–π–º–∞–π —É–≥–æ–ª",
                desc: "–ø–æ–≤–µ—Ä–Ω–∏ –¥–∏—Å–∫ –Ω–∞ 60¬∞",
                target: 60,
                render: function(container, onComplete) {
                    let angle = 0;
                    
                    container.innerHTML = `
                        <div style="text-align: center;">
                            <div class="dial" id="dial">
                                <div class="dial-handle" id="handle"></div>
                            </div>
                            <div style="font-size: 2rem; color: #ffd966;" id="dialAngle">0¬∞</div>
                            <button class="action-btn" id="checkDial">–≥–æ—Ç–æ–≤–æ</button>
                        </div>
                    `;
                    
                    const dial = document.getElementById('dial');
                    const handle = document.getElementById('handle');
                    let dragging = false;
                    
                    dial.addEventListener('mousedown', () => dragging = true);
                    dial.addEventListener('mouseup', () => dragging = false);
                    dial.addEventListener('mouseleave', () => dragging = false);
                    
                    dial.addEventListener('mousemove', (e) => {
                        if (!dragging) return;
                        const rect = dial.getBoundingClientRect();
                        const centerX = rect.left + rect.width/2;
                        const centerY = rect.top + rect.height/2;
                        const angle = Math.atan2(e.clientY - centerY, e.clientX - centerX) * 180 / Math.PI;
                        const normalized = (angle + 360) % 360;
                        handle.style.transform = `translate(-50%, -50%) rotate(${normalized}deg)`;
                        document.getElementById('dialAngle').textContent = Math.round(normalized) + '¬∞';
                    });
                    
                    document.getElementById('checkDial').addEventListener('click', () => {
                        const current = parseInt(document.getElementById('dialAngle').textContent);
                        if (Math.abs(current - this.target) < 5) {
                            onComplete(true);
                        } else {
                            alert(`–Ω—É–∂–Ω–æ ${this.target}¬∞`);
                        }
                    });
                }
            },
            
            {   // 5. –õ–ê–ó–ï–† - —Ü–µ–ª—å—Å—è
                id: 5,
                type: "laser",
                title: "üî´ –ø–æ–ø–∞–¥–∏ –≤ —Ü–µ–ª—å",
                desc: "–Ω–∞–∂–º–∏ –Ω–∞ —ç–∫—Ä–∞–Ω, —á—Ç–æ–±—ã –≤—ã—Å—Ç—Ä–µ–ª–∏—Ç—å",
                target: {x: 70, y: 50},
                render: function(container, onComplete) {
                    container.innerHTML = `
                        <canvas id="laserCanvas" class="laser-canvas"></canvas>
                        <button class="action-btn" id="fireBtn">üî´ –≤—ã—Å—Ç—Ä–µ–ª</button>
                    `;
                    
                    const canvas = document.getElementById('laserCanvas');
                    const ctx = canvas.getContext('2d');
                    canvas.width = canvas.offsetWidth;
                    canvas.height = canvas.offsetHeight;
                    
                    let shots = 0;
                    
                    function drawTarget() {
                        ctx.clearRect(0, 0, canvas.width, canvas.height);
                        ctx.fillStyle = '#ff4444';
                        ctx.beginPath();
                        ctx.arc(70, 50, 10, 0, 2*Math.PI);
                        ctx.fill();
                    }
                    
                    drawTarget();
                    
                    canvas.addEventListener('click', (e) => {
                        const rect = canvas.getBoundingClientRect();
                        const x = e.clientX - rect.left;
                        const y = e.clientY - rect.top;
                        
                        ctx.beginPath();
                        ctx.strokeStyle = '#ffff00';
                        ctx.lineWidth = 3;
                        ctx.moveTo(0, canvas.height/2);
                        ctx.lineTo(x, y);
                        ctx.stroke();
                        
                        shots++;
                        
                        if (shots >= 3) {
                            onComplete(true);
                        }
                    });
                    
                    document.getElementById('fireBtn').addEventListener('click', () => {
                        onComplete(true);
                    });
                }
            },
            
            {   // 6. –ö–ù–û–ü–ö–ò - –Ω–∞–∂–º–∏ –ø—Ä–∞–≤–∏–ª—å–Ω—É—é
                id: 6,
                type: "buttons",
                title: "üíß –≥–¥–µ –≤–æ–¥–∞?",
                desc: "–Ω–∞–∂–º–∏ –Ω–∞ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç",
                buttons: ["–≤–æ–∑–¥—É—Ö", "–≤–æ–¥–∞", "—Å—Ç–µ–∫–ª–æ", "–∞–ª–º–∞–∑"],
                correct: 1,
                render: function(container, onComplete) {
                    container.innerHTML = `
                        <div style="display: grid; gap: 10px;">
                            ${this.buttons.map((btn, i) => `
                                <button class="action-btn" data-index="${i}">${btn}</button>
                            `).join('')}
                        </div>
                    `;
                    
                    container.querySelectorAll('.action-btn').forEach(btn => {
                        btn.addEventListener('click', (e) => {
                            if (e.target.dataset.index == this.correct) {
                                onComplete(true);
                            } else {
                                alert('–Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ, –ø–æ–ø—Ä–æ–±—É–π –µ—â—ë');
                            }
                        });
                    });
                }
            },
            
            {   // 7. –ü–û–†–Ø–î–û–ö - —Ä–∞–∑–ª–æ–∂–∏ —Ü–≤–µ—Ç–∞
                id: 7,
                type: "order",
                title: "üåà —Ü–≤–µ—Ç–∞ —Ä–∞–¥—É–≥–∏",
                desc: "—Ç–∞–ø–∞–π –ø–æ —Ü–≤–µ—Ç–∞–º –≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–º –ø–æ—Ä—è–¥–∫–µ",
                colors: ["üî¥", "üü†", "üü°", "üü¢", "üîµ", "üü£"],
                render: function(container, onComplete) {
                    let selected = [];
                    let shuffled = [...this.colors].sort(() => Math.random() - 0.5);
                    
                    container.innerHTML = `
                        <div style="display: flex; flex-wrap: wrap; gap: 10px; justify-content: center;" id="colorContainer">
                            ${shuffled.map(c => `<div class="memory-card" style="width: 60px;">${c}</div>`).join('')}
                        </div>
                        <div style="margin: 20px; min-height: 60px; display: flex; gap: 10px; justify-content: center;" id="selectedColors"></div>
                        <button class="action-btn" id="checkOrder">–ø—Ä–æ–≤–µ—Ä–∏—Ç—å</button>
                    `;
                    
                    document.querySelectorAll('.memory-card').forEach(card => {
                        card.addEventListener('click', () => {
                            if (card.parentElement.id === 'colorContainer') {
                                card.remove();
                                document.getElementById('selectedColors').appendChild(card);
                                selected.push(card.textContent);
                            }
                        });
                    });
                    
                    document.getElementById('checkOrder').addEventListener('click', () => {
                        if (selected.join('') === 'üî¥üü†üü°üü¢üîµüü£') {
                            onComplete(true);
                        } else {
                            alert('–Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø–æ—Ä—è–¥–æ–∫!');
                        }
                    });
                }
            },
            
            {   // 8. –ö–ê–õ–¨–ö–£–õ–Ø–¢–û–† - –≤–≤–µ–¥–∏ —á–∏—Å–ª–æ
                id: 8,
                type: "calc",
                title: "üßÆ –ø–æ—Å—á–∏—Ç–∞–π",
                desc: "n = 300000 / 200000 = ?",
                correct: 1.5,
                render: function(container, onComplete) {
                    container.innerHTML = `
                        <input type="number" id="calcInput" class="input-box" step="0.1" style="font-size: 2rem;">
                        <button class="action-btn" id="checkCalc">–ø—Ä–æ–≤–µ—Ä–∏—Ç—å</button>
                    `;
                    
                    document.getElementById('checkCalc').addEventListener('click', () => {
                        const val = parseFloat(document.getElementById('calcInput').value);
                        if (Math.abs(val - this.correct) < 0.1) {
                            onComplete(true);
                        } else {
                            alert('–Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ!');
                        }
                    });
                }
            },
            
            {   // 9. –†–ò–°–û–í–ê–õ–ö–ê - –Ω–∞—Ä–∏—Å—É–π –ª—É—á
                id: 9,
                type: "draw",
                title: "‚úèÔ∏è –Ω–∞—Ä–∏—Å—É–π –ª—É—á",
                desc: "–Ω–∞—Ä–∏—Å—É–π –ø–∞–ª—å—Ü–µ–º, –∫–∞–∫ –ø–æ–π–¥—ë—Ç –ª—É—á",
                render: function(container, onComplete) {
                    container.innerHTML = `
                        <canvas id="drawCanvas" class="laser-canvas"></canvas>
                        <button class="action-btn" id="clearDraw">–æ—á–∏—Å—Ç–∏—Ç—å</button>
                        <button class="action-btn" id="checkDraw">–≥–æ—Ç–æ–≤–æ</button>
                    `;
                    
                    const canvas = document.getElementById('drawCanvas');
                    const ctx = canvas.getContext('2d');
                    canvas.width = canvas.offsetWidth;
                    canvas.height = canvas.offsetHeight;
                    
                    let drawing = false;
                    
                    canvas.addEventListener('touchstart', () => drawing = true);
                    canvas.addEventListener('touchend', () => drawing = false);
                    canvas.addEventListener('touchmove', (e) => {
                        e.preventDefault();
                        if (!drawing) return;
                        const rect = canvas.getBoundingClientRect();
                        const x = e.touches[0].clientX - rect.left;
                        const y = e.touches[0].clientY - rect.top;
                        
                        ctx.beginPath();
                        ctx.strokeStyle = '#ffff00';
                        ctx.lineWidth = 3;
                        ctx.lineTo(x, y);
                        ctx.stroke();
                    });
                    
                    document.getElementById('clearDraw').addEventListener('click', () => {
                        ctx.clearRect(0, 0, canvas.width, canvas.height);
                    });
                    
                    document.getElementById('checkDraw').addEventListener('click', () => {
                        onComplete(true);
                    });
                }
            },
            
            {   // 10. –§–ò–ù–ê–õ - —Å–æ–±–µ—Ä–∏ —Å–ª–æ–≤–æ
                id: 10,
                type: "word",
                title: "üî§ —Å–æ–±–µ—Ä–∏ —Å–ª–æ–≤–æ",
                desc: "–° ¬∑ –í ¬∑ –ï ¬∑ –¢",
                letters: ["–°", "–í", "–ï", "–¢"],
                render: function(container, onComplete) {
                    let selected = [];
                    
                    container.innerHTML = `
                        <div style="display: flex; gap: 10px; justify-content: center; margin: 20px;">
                            ${this.letters.map(l => `
                                <div class="memory-card" style="width: 60px;">${l}</div>
                            `).join('')}
                        </div>
                        <div style="min-height: 60px; display: flex; gap: 10px; justify-content: center; background: rgba(0,0,0,0.3); border-radius: 20px; padding: 10px;" id="wordArea"></div>
                        <button class="action-btn" id="checkWord">–ø—Ä–æ–≤–µ—Ä–∏—Ç—å</button>
                    `;
                    
                    document.querySelectorAll('.memory-card').forEach(card => {
                        card.addEventListener('click', () => {
                            const clone = card.cloneNode(true);
                            document.getElementById('wordArea').appendChild(clone);
                            selected.push(card.textContent);
                        });
                    });
                    
                    document.getElementById('checkWord').addEventListener('click', () => {
                        if (selected.join('') === '–°–í–ï–¢') {
                            onComplete(true);
                        } else {
                            alert('–Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ!');
                        }
                    });
                }
            }
        ];

        // –°–æ—Å—Ç–æ—è–Ω–∏–µ –∏–≥—Ä—ã
        let currentGameId = null;
        let playerName = null;
        let completedTasks = {};
        let currentTaskIndex = 0;

        // ===== –í–•–û–î =====
        function joinGame() {
            const name = document.getElementById('playerName').value.trim();
            const code = document.getElementById('gameCode').value.trim();

            if (!name || name.length < 2) return alert('–Ω–∞–ø–∏—à–∏ –∏–º—è');
            if (!code || code.length !== 6) return alert('–Ω—É–∂–µ–Ω 6-–∑–Ω–∞—á–Ω—ã–π –∫–æ–¥');

            playerName = name;
            currentGameId = `game_${code}`;

            document.getElementById('displayCode').textContent = code;
            
            document.getElementById('lobby').classList.add('hidden');
            document.getElementById('waiting').classList.remove('hidden');

            db.ref(`games/${currentGameId}`).once('value', (snapshot) => {
                if (!snapshot.exists()) {
                    alert('–∏–≥—Ä–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞');
                    document.getElementById('lobby').classList.remove('hidden');
                    document.getElementById('waiting').classList.add('hidden');
                    return;
                }

                db.ref(`games/${currentGameId}/players/${name}`).set({
                    name: name,
                    joinedAt: Date.now(),
                    completed: 0
                });

                listenToGame();
            });
        }

        // ===== –°–õ–£–®–ê–ï–ú =====
        function listenToGame() {
            db.ref(`games/${currentGameId}`).on('value', (snapshot) => {
                const game = snapshot.val();
                if (!game) return;

                updatePlayersList(game.players);

                if (game.status === 'active') {
                    document.getElementById('waiting').classList.add('hidden');
                    document.getElementById('game').classList.remove('hidden');
                    renderTasksGrid();
                }
            });
        }

        // ===== –°–ï–¢–ö–ê –ó–ê–î–ê–ù–ò–ô =====
        function renderTasksGrid() {
            let html = '';
            for (let i = 0; i < TASKS.length; i++) {
                const completed = completedTasks[i+1] ? 'completed' : '';
                html += `<div class="task-cell ${completed}" onclick="openTask(${i})">${i+1}</div>`;
            }
            document.getElementById('tasksGrid').innerHTML = html;
        }

        // ===== –û–¢–ö–†–´–¢–¨ –ó–ê–î–ê–ù–ò–ï =====
        function openTask(index) {
            currentTaskIndex = index;
            const task = TASKS[index];
            
            const area = document.getElementById('interactiveArea');
            area.innerHTML = `
                <div style="color: #ffd89c; margin-bottom: 10px;">${task.title}</div>
                <div style="margin-bottom: 20px;">${task.desc}</div>
                <div id="taskContent"></div>
            `;
            
            task.render(document.getElementById('taskContent'), (success) => {
                if (success) {
                    completedTasks[index+1] = true;
                    db.ref(`games/${currentGameId}/players/${playerName}/completed`).set(Object.keys(completedTasks).length);
                    renderTasksGrid();
                    alert('‚úÖ –∑–∞–¥–∞–Ω–∏–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–æ!');
                }
            });
        }

        // ===== –û–ë–ù–û–í–õ–ï–ù–ò–ï –ò–ì–†–û–ö–û–í =====
        function updatePlayersList(players) {
            const list = document.getElementById('playersList');
            if (!players) return;
            
            list.innerHTML = Object.keys(players).map(name => 
                `<div style="color: #ffd89c;">üë§ ${name}</div>`
            ).join('');
        }

        // ===== –í–´–•–û–î =====
        function exitGame() {
            location.reload();
        }

        // –§–æ—Ä–º–∞—Ç –∫–æ–¥–∞
        document.getElementById('gameCode').addEventListener('input', function() {
            this.value = this.value.replace(/\D/g, '').substring(0, 6);
        });
    </script>
</body>
</html>
